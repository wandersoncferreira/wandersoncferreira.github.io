<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<style type=text/css>body{font-family:monospace}</style>
<title>emacs - projectile and perspective</title>
<link rel=stylesheet href=/css/style.css>
</head>
<body>
<header>
<a href=/en>Wanderson Ferreira</a> - <a href=/pt>pt-BR</a> / <a href=/en>en</a>
<br>
-------------------------------
<div style=float:right>Reifying fragmented ideas</div><br>
<p>
<nav>
<a href=/en><b>Posts</b></a>.
<a href=/en/tags/><b>Tags</b></a>.
</nav>
</p>
</header>
<main>
<article>
<h1>emacs - projectile and perspective</h1>
<b><time>2022-02-13 00:00:00</time></b>
<a href=/en/tags/emacs>emacs</a>
<div>
<p>I&rsquo;d like to have one workspace for each project I work on. The desired
workflow is simple:</p>
<ol>
<li>Use <code>projectile-switch-project</code></li>
<li>Choose a project</li>
<li>Automatically create a new workspace with the project name</li>
<li>Switch to the new workspace</li>
<li>Open file in the new workspace</li>
<li>Commands like <code>ido-switch-buffer</code> needs to recognize only buffers of this workspace</li>
</ol>
<p>Great! To accomplish this I am using <a href=https://github.com/bbatsov/projectile>projectile</a> and <a href=https://github.com/nex3/perspective-el>perspective</a>.</p>
<p>Simply enable projectile and perspective:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-elisp data-lang=elisp><span class=p>(</span><span class=nb>require</span> <span class=ss>&#39;perspective</span><span class=p>)</span>

<span class=p>(</span><span class=nv>persp-mode</span> <span class=no>t</span><span class=p>)</span>

<span class=p>(</span><span class=nb>require</span> <span class=ss>&#39;projectile</span><span class=p>)</span>

<span class=p>(</span><span class=nv>projectile-mode</span> <span class=mi>+1</span><span class=p>)</span>
</code></pre></div><p>Projectile has a nice hook called
<code>projectile-before-switch-project-hook</code> which seems exactly what I
need i.e. before switching to the project, create the new perspective!</p>
<p>However, there is a single problem. How can we get the name of the
selected project? The function <code>projectile-project-root</code> will return
an outdated value if you call it inside our hook because the hook is
called before the chosen project name is used by projectile.</p>
<p>Not a problem, let&rsquo;s hack it!</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=p>(</span><span class=nb>defvar</span> <span class=nv>bk--projectile-target-project</span> <span class=no>nil</span>
  <span class=s>&#34;Hold the target projectile name.&#34;</span><span class=p>)</span>

<span class=p>(</span><span class=nb>defun</span> <span class=nv>bk/projectile-switch-project-by-name</span> <span class=p>(</span><span class=nv>projectile-switch-project-by-name</span> <span class=kp>&amp;rest</span> <span class=nv>args</span><span class=p>)</span>
  <span class=p>(</span><span class=nb>setq</span> <span class=nv>bk--projectile-target-project</span> <span class=p>(</span><span class=nv>-&gt;&gt;</span> <span class=p>(</span><span class=nv>split-string</span> <span class=p>(</span><span class=nf>car</span> <span class=nv>args</span><span class=p>)</span> <span class=s>&#34;/&#34;</span><span class=p>)</span>
                                           <span class=p>(</span><span class=nv>-drop-last</span> <span class=mi>1</span><span class=p>)</span>
                                           <span class=p>(</span><span class=nv>-last-item</span><span class=p>)))</span>
  <span class=p>(</span><span class=nf>apply</span> <span class=nv>projectile-switch-project-by-name</span> <span class=nv>args</span><span class=p>))</span>

<span class=p>(</span><span class=nv>advice-add</span> <span class=nf>#&#39;</span><span class=nv>projectile-switch-project-by-name</span> <span class=nb>:around</span> <span class=nf>#&#39;</span><span class=nv>bk/projectile-switch-project-by-name</span><span class=p>)</span>
</code></pre></div><p>The advice will extract the chosen project name and keep it in
<code>bk--projectile-target-project</code> so we can use it later on. Keep in
mind that collisions can happen if you have two projects with the same
name in different folders.</p>
<p>And finally, we can use our hook</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-emacs-lisp data-lang=emacs-lisp><span class=p>(</span><span class=nb>defun</span> <span class=nv>bk/new-persp-for-project-switch</span> <span class=p>()</span>
  <span class=p>(</span><span class=nv>persp-switch</span> <span class=nv>bk--projectile-target-project</span><span class=p>))</span>

<span class=p>(</span><span class=nv>add-hook</span> <span class=ss>&#39;projectile-before-switch-project-hook</span> <span class=nf>#&#39;</span><span class=nv>bk/new-persp-for-project-switch</span><span class=p>)</span>
</code></pre></div><p>Easy!</p>
<p>Now, every time you switch a project using projectile a new
perspective will be created.</p>
</div>
</article>
</main>
<aside>
<div>
<div>
<h3>LATEST POSTS</h3>
</div>
<div>
<ul>
<li><a href=/en/items/20220213204546-emacs_projectile_and_perspective/>emacs - projectile and perspective</a></li>
<li><a href=/en/items/20220111222641-emacs_automation_don_t_need_to_look_pretty/>emacs - automation don't need to look pretty</a></li>
<li><a href=/en/items/20220104144350-role_of_software/>role of software</a></li>
<li><a href=/en/items/20220104151027-we_dont_know_how_to_compute/>we dont know how to compute</a></li>
<li><a href=/en/items/why-clojure/>why clojure?</a></li>
</ul>
</div>
</div>
</aside>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//bartuka.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<footer>
<p>&copy; 2022 <a href=https://wandersoncferreira.github.io><b>Wanderson Ferreira</b></a>.
<a href=https://github.com/wandersoncferreira><b>Github</b></a>.
<a href=https://twitter.com/bartuka_><b>Twitter</b></a>.
</p>
</footer>
</body>
</html>